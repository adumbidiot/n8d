<html>
	<head>
		<title>SWFTools</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.6/pako.js"></script>
		<script src="SWFTools.js"></script>
	</head>
	<body>
		<button onclick="loadPong()">Pong</button>
		<br>
		<button onclick="loadTest()">Test</button>
		<p id="output"></p>
		<h2>Ascii Dump</h2>
		<textarea id="dump" style="width: 100%; height: 50%;"></textarea>
		<p><a href="http://www-lehre.informatik.uni-osnabrueck.de/~fbstark/diplom/docs/swf/Intro.htm" target="_blank">Good Resource?</a></p>
		<p><a href = "https://wwwimages2.adobe.com/content/dam/acom/en/devnet/pdf/swf-file-format-spec.pdf">SWF 19 Spec</a></p>
		<script>
			function loadPong(){
				filename = 'games/pong.swf';
				SWFTools.fetchAndParse(parser, filename);
			}
			
			function loadTest(){
				filename = 'games/test.swf';
				SWFTools.fetchAndParse(parser, filename);
			}
			
			let startTime = null;
			let endTime = null;
			let output = document.getElementById('output');
			
			console.log('SWFTools Version: ' + SWFTools.VERSION);
			console.log('SWFParser Version: ' + SWFTools.SWFParser.VERSION);
			
			let parser = new SWFTools.SWFParser();
			let filename = 'games/test.swf'; //'games/pong.swf'
			SWFTools.fetchAndParse(parser, filename);
			parser.on('start', function(){
				output.innerHTML = '';
				startTime = new Date();
				//console.log('Parse started at ' + startTime);
			});
			parser.on('header', function(header){
				//console.log(header);
			});
			parser.on('tag', function(tag){
				//console.log(tag);
				output.innerHTML += '(' + tag.name + ', ' + tag.recordHeader.code  +')<br>';
				if(tag.name !== 'UnknownTag'){
					console.log(tag);
				}
			});
			parser.on('end', function(i){
				endTime = new Date();
				let time = (endTime.getTime() - startTime.getTime());
				output.innerHTML += '<b>' + i + ' tags parsed in ' + time + ' ms (' + (i/time).toFixed(2) + ' tags per millisecond)' +'</b><br>';
			});
			
		</script>
	</body>
</html>